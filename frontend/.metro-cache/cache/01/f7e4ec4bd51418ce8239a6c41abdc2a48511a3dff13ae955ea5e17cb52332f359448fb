{"dependencies":[{"name":"react","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":1,"column":0,"index":0},"end":{"line":1,"column":87,"index":87}}],"key":"RtGiGa+/H7VrI7GDQDLhO1UbpU8=","exportNames":["*"],"imports":1}},{"name":"@react-native-async-storage/async-storage","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":2,"column":0,"index":88},"end":{"line":2,"column":69,"index":157}}],"key":"0kSRlooyBOaYM9tlTtK91nq+uds=","exportNames":["*"],"imports":1}},{"name":"../api/client","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":3,"column":0,"index":158},"end":{"line":3,"column":50,"index":208}}],"key":"vrY6iF+Nd2CrRu9d6eBxeX1BPiA=","exportNames":["*"],"imports":1}},{"name":"react/jsx-dev-runtime","data":{"asyncType":null,"isESMImport":false,"locs":[],"key":"L9D70Z4hi4aGuui1ysja/oQ5ytI=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  var _jsxFileName = \"/app/frontend/src/context/AuthContext.tsx\";\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n  function _interopDefault(e) {\n    return e && e.__esModule ? e : {\n      default: e\n    };\n  }\n  Object.defineProperty(exports, \"AuthProvider\", {\n    enumerable: true,\n    get: function () {\n      return AuthProvider;\n    }\n  });\n  Object.defineProperty(exports, \"useAuth\", {\n    enumerable: true,\n    get: function () {\n      return useAuth;\n    }\n  });\n  var _react = require(_dependencyMap[0], \"react\");\n  var _reactNativeAsyncStorageAsyncStorage = require(_dependencyMap[1], \"@react-native-async-storage/async-storage\");\n  var AsyncStorage = _interopDefault(_reactNativeAsyncStorageAsyncStorage);\n  var _apiClient = require(_dependencyMap[2], \"../api/client\");\n  var _reactJsxDevRuntime = require(_dependencyMap[3], \"react/jsx-dev-runtime\");\n  const AuthContext = /*#__PURE__*/(0, _react.createContext)(undefined);\n  const STORAGE_KEY_TOKEN = \"meatsafe_token\";\n  const STORAGE_KEY_USER = \"meatsafe_user\";\n  const AuthProvider = ({\n    children\n  }) => {\n    const [user, setUser] = (0, _react.useState)(null);\n    const [token, setToken] = (0, _react.useState)(null);\n    const [loading, setLoading] = (0, _react.useState)(true);\n    (0, _react.useEffect)(() => {\n      const init = async () => {\n        try {\n          const [storedToken, storedUser] = await Promise.all([AsyncStorage.default.getItem(STORAGE_KEY_TOKEN), AsyncStorage.default.getItem(STORAGE_KEY_USER)]);\n          if (storedToken && storedUser) {\n            // Tenter de valider le token auprès du backend\n            (0, _apiClient.setAuthToken)(storedToken);\n            try {\n              const meRes = await _apiClient.api.get(\"/users/me\");\n              const userData = meRes.data;\n              setToken(storedToken);\n              setUser(userData);\n              await AsyncStorage.default.setItem(STORAGE_KEY_USER, JSON.stringify(userData));\n            } catch (e) {\n              // Token invalide ou backend injoignable: forcer la reconnexion\n              console.warn(\"Token invalide ou expiré, nettoyage de la session\", e);\n              setToken(null);\n              setUser(null);\n              (0, _apiClient.setAuthToken)(null);\n              await Promise.all([AsyncStorage.default.removeItem(STORAGE_KEY_TOKEN), AsyncStorage.default.removeItem(STORAGE_KEY_USER)]);\n            }\n          }\n        } catch (error) {\n          console.warn(\"Erreur lors du chargement du token\", error);\n        } finally {\n          setLoading(false);\n        }\n      };\n      void init();\n    }, []);\n    const login = async ({\n      email,\n      password\n    }) => {\n      try {\n        const formData = new URLSearchParams({\n          username: email.trim(),\n          password: password.trim()\n        });\n        const response = await _apiClient.api.post(\"/auth/login\", formData, {\n          headers: {\n            \"Content-Type\": \"application/x-www-form-urlencoded\"\n          }\n        });\n        const {\n          access_token,\n          user: userData\n        } = response.data;\n        setToken(access_token);\n        (0, _apiClient.setAuthToken)(access_token);\n        setUser(userData);\n        await Promise.all([AsyncStorage.default.setItem(STORAGE_KEY_TOKEN, access_token), AsyncStorage.default.setItem(STORAGE_KEY_USER, JSON.stringify(userData))]);\n      } catch (error) {\n        console.error(\"Erreur de connexion\", error);\n        throw error;\n      }\n    };\n    const logout = async () => {\n      setUser(null);\n      setToken(null);\n      (0, _apiClient.setAuthToken)(null);\n      await Promise.all([AsyncStorage.default.removeItem(STORAGE_KEY_TOKEN), AsyncStorage.default.removeItem(STORAGE_KEY_USER)]);\n    };\n    const value = (0, _react.useMemo)(() => ({\n      user,\n      token,\n      loading,\n      login,\n      logout\n    }), [user, token, loading]);\n    return /*#__PURE__*/(0, _reactJsxDevRuntime.jsxDEV)(AuthContext.Provider, {\n      value: value,\n      children: children\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 117,\n      columnNumber: 10\n    }, this);\n  };\n  const useAuth = () => {\n    const ctx = (0, _react.useContext)(AuthContext);\n    if (!ctx) {\n      throw new Error(\"useAuth doit être utilisé dans un AuthProvider\");\n    }\n    return ctx;\n  };\n});","lineCount":125,"map":[[13,2,32,0,"Object"],[13,8,32,0],[13,9,32,0,"defineProperty"],[13,23,32,0],[13,24,32,0,"exports"],[13,31,32,0],[14,4,32,0,"enumerable"],[14,14,32,0],[15,4,32,0,"get"],[15,7,32,0],[15,18,32,0,"get"],[15,19,32,0],[16,6,32,0],[16,13,32,0,"AuthProvider"],[16,25,32,0],[17,4,32,0],[18,2,32,0],[19,2,120,0,"Object"],[19,8,120,0],[19,9,120,0,"defineProperty"],[19,23,120,0],[19,24,120,0,"exports"],[19,31,120,0],[20,4,120,0,"enumerable"],[20,14,120,0],[21,4,120,0,"get"],[21,7,120,0],[21,18,120,0,"get"],[21,19,120,0],[22,6,120,0],[22,13,120,0,"useAuth"],[22,20,120,0],[23,4,120,0],[24,2,120,0],[25,2,1,0],[25,6,1,0,"_react"],[25,12,1,0],[25,15,1,0,"require"],[25,22,1,0],[25,23,1,0,"_dependencyMap"],[25,37,1,0],[26,2,2,0],[26,6,2,0,"_reactNativeAsyncStorageAsyncStorage"],[26,42,2,0],[26,45,2,0,"require"],[26,52,2,0],[26,53,2,0,"_dependencyMap"],[26,67,2,0],[27,2,2,0],[27,6,2,0,"AsyncStorage"],[27,18,2,0],[27,21,2,0,"_interopDefault"],[27,36,2,0],[27,37,2,0,"_reactNativeAsyncStorageAsyncStorage"],[27,73,2,0],[28,2,3,0],[28,6,3,0,"_apiClient"],[28,16,3,0],[28,19,3,0,"require"],[28,26,3,0],[28,27,3,0,"_dependencyMap"],[28,41,3,0],[29,2,3,50],[29,6,3,50,"_reactJsxDevRuntime"],[29,25,3,50],[29,28,3,50,"require"],[29,35,3,50],[29,36,3,50,"_dependencyMap"],[29,50,3,50],[30,2,27,0],[30,8,27,6,"AuthContext"],[30,19,27,17],[30,35,27,20],[30,39,27,20,"createContext"],[30,45,27,33],[30,46,27,33,"createContext"],[30,59,27,33],[30,61,27,64,"undefined"],[30,70,27,73],[30,71,27,74],[31,2,29,0],[31,8,29,6,"STORAGE_KEY_TOKEN"],[31,25,29,23],[31,28,29,26],[31,44,29,42],[32,2,30,0],[32,8,30,6,"STORAGE_KEY_USER"],[32,24,30,22],[32,27,30,25],[32,42,30,40],[33,2,32,7],[33,8,32,13,"AuthProvider"],[33,20,32,66],[33,23,32,69,"AuthProvider"],[33,24,32,70],[34,4,32,72,"children"],[35,2,32,81],[35,3,32,82],[35,8,32,87],[36,4,33,2],[36,10,33,8],[36,11,33,9,"user"],[36,15,33,13],[36,17,33,15,"setUser"],[36,24,33,22],[36,25,33,23],[36,28,33,26],[36,32,33,26,"useState"],[36,38,33,34],[36,39,33,34,"useState"],[36,47,33,34],[36,49,33,52],[36,53,33,56],[36,54,33,57],[37,4,34,2],[37,10,34,8],[37,11,34,9,"token"],[37,16,34,14],[37,18,34,16,"setToken"],[37,26,34,24],[37,27,34,25],[37,30,34,28],[37,34,34,28,"useState"],[37,40,34,36],[37,41,34,36,"useState"],[37,49,34,36],[37,51,34,52],[37,55,34,56],[37,56,34,57],[38,4,35,2],[38,10,35,8],[38,11,35,9,"loading"],[38,18,35,16],[38,20,35,18,"setLoading"],[38,30,35,28],[38,31,35,29],[38,34,35,32],[38,38,35,32,"useState"],[38,44,35,40],[38,45,35,40,"useState"],[38,53,35,40],[38,55,35,41],[38,59,35,45],[38,60,35,46],[39,4,37,2],[39,8,37,2,"useEffect"],[39,14,37,11],[39,15,37,11,"useEffect"],[39,24,37,11],[39,26,37,12],[39,32,37,18],[40,6,38,4],[40,12,38,10,"init"],[40,16,38,14],[40,19,38,17],[40,25,38,17,"init"],[40,26,38,17],[40,31,38,29],[41,8,39,6],[41,12,39,10],[42,10,40,8],[42,16,40,14],[42,17,40,15,"storedToken"],[42,28,40,26],[42,30,40,28,"storedUser"],[42,40,40,38],[42,41,40,39],[42,44,40,42],[42,50,40,48,"Promise"],[42,57,40,55],[42,58,40,56,"all"],[42,61,40,59],[42,62,40,60],[42,63,41,10,"AsyncStorage"],[42,75,41,22],[42,76,41,22,"default"],[42,83,41,22],[42,84,41,23,"getItem"],[42,91,41,30],[42,92,41,31,"STORAGE_KEY_TOKEN"],[42,109,41,48],[42,110,41,49],[42,112,42,10,"AsyncStorage"],[42,124,42,22],[42,125,42,22,"default"],[42,132,42,22],[42,133,42,23,"getItem"],[42,140,42,30],[42,141,42,31,"STORAGE_KEY_USER"],[42,157,42,47],[42,158,42,48],[42,159,43,9],[42,160,43,10],[43,10,45,8],[43,14,45,12,"storedToken"],[43,25,45,23],[43,29,45,27,"storedUser"],[43,39,45,37],[43,41,45,39],[44,12,46,10],[45,12,47,10],[45,16,47,10,"setAuthToken"],[45,26,47,22],[45,27,47,22,"setAuthToken"],[45,39,47,22],[45,41,47,23,"storedToken"],[45,52,47,34],[45,53,47,35],[46,12,48,10],[46,16,48,14],[47,14,49,12],[47,20,49,18,"meRes"],[47,25,49,23],[47,28,49,26],[47,34,49,32,"api"],[47,44,49,35],[47,45,49,35,"api"],[47,48,49,35],[47,49,49,36,"get"],[47,52,49,39],[47,53,49,40],[47,64,49,51],[47,65,49,52],[48,14,50,12],[48,20,50,18,"userData"],[48,28,50,26],[48,31,50,29,"meRes"],[48,36,50,34],[48,37,50,35,"data"],[48,41,50,51],[49,14,51,12,"setToken"],[49,22,51,20],[49,23,51,21,"storedToken"],[49,34,51,32],[49,35,51,33],[50,14,52,12,"setUser"],[50,21,52,19],[50,22,52,20,"userData"],[50,30,52,28],[50,31,52,29],[51,14,53,12],[51,20,53,18,"AsyncStorage"],[51,32,53,30],[51,33,53,30,"default"],[51,40,53,30],[51,41,53,31,"setItem"],[51,48,53,38],[51,49,53,39,"STORAGE_KEY_USER"],[51,65,53,55],[51,67,53,57,"JSON"],[51,71,53,61],[51,72,53,62,"stringify"],[51,81,53,71],[51,82,53,72,"userData"],[51,90,53,80],[51,91,53,81],[51,92,53,82],[52,12,54,10],[52,13,54,11],[52,14,54,12],[52,21,54,19,"e"],[52,22,54,20],[52,24,54,22],[53,14,55,12],[54,14,56,12,"console"],[54,21,56,19],[54,22,56,20,"warn"],[54,26,56,24],[54,27,56,25],[54,78,56,76],[54,80,56,78,"e"],[54,81,56,79],[54,82,56,80],[55,14,57,12,"setToken"],[55,22,57,20],[55,23,57,21],[55,27,57,25],[55,28,57,26],[56,14,58,12,"setUser"],[56,21,58,19],[56,22,58,20],[56,26,58,24],[56,27,58,25],[57,14,59,12],[57,18,59,12,"setAuthToken"],[57,28,59,24],[57,29,59,24,"setAuthToken"],[57,41,59,24],[57,43,59,25],[57,47,59,29],[57,48,59,30],[58,14,60,12],[58,20,60,18,"Promise"],[58,27,60,25],[58,28,60,26,"all"],[58,31,60,29],[58,32,60,30],[58,33,61,14,"AsyncStorage"],[58,45,61,26],[58,46,61,26,"default"],[58,53,61,26],[58,54,61,27,"removeItem"],[58,64,61,37],[58,65,61,38,"STORAGE_KEY_TOKEN"],[58,82,61,55],[58,83,61,56],[58,85,62,14,"AsyncStorage"],[58,97,62,26],[58,98,62,26,"default"],[58,105,62,26],[58,106,62,27,"removeItem"],[58,116,62,37],[58,117,62,38,"STORAGE_KEY_USER"],[58,133,62,54],[58,134,62,55],[58,135,63,13],[58,136,63,14],[59,12,64,10],[60,10,65,8],[61,8,66,6],[61,9,66,7],[61,10,66,8],[61,17,66,15,"error"],[61,22,66,20],[61,24,66,22],[62,10,67,8,"console"],[62,17,67,15],[62,18,67,16,"warn"],[62,22,67,20],[62,23,67,21],[62,59,67,57],[62,61,67,59,"error"],[62,66,67,64],[62,67,67,65],[63,8,68,6],[63,9,68,7],[63,18,68,16],[64,10,69,8,"setLoading"],[64,20,69,18],[64,21,69,19],[64,26,69,24],[64,27,69,25],[65,8,70,6],[66,6,71,4],[66,7,71,5],[67,6,73,4],[67,11,73,9,"init"],[67,15,73,13],[67,16,73,14],[67,17,73,15],[68,4,74,2],[68,5,74,3],[68,7,74,5],[68,9,74,7],[68,10,74,8],[69,4,76,2],[69,10,76,8,"login"],[69,15,76,13],[69,18,76,16],[69,24,76,16,"login"],[69,25,76,23],[70,6,76,25,"email"],[70,11,76,30],[71,6,76,32,"password"],[72,4,76,54],[72,5,76,55],[72,10,76,60],[73,6,77,4],[73,10,77,8],[74,8,78,6],[74,14,78,12,"formData"],[74,22,78,20],[74,25,78,23],[74,29,78,27,"URLSearchParams"],[74,44,78,42],[74,45,78,43],[75,10,79,8,"username"],[75,18,79,16],[75,20,79,18,"email"],[75,25,79,23],[75,26,79,24,"trim"],[75,30,79,28],[75,31,79,29],[75,32,79,30],[76,10,80,8,"password"],[76,18,80,16],[76,20,80,18,"password"],[76,28,80,26],[76,29,80,27,"trim"],[76,33,80,31],[76,34,80,32],[77,8,81,6],[77,9,81,7],[77,10,81,8],[78,8,83,6],[78,14,83,12,"response"],[78,22,83,20],[78,25,83,23],[78,31,83,29,"api"],[78,41,83,32],[78,42,83,32,"api"],[78,45,83,32],[78,46,83,33,"post"],[78,50,83,37],[78,51,83,38],[78,64,83,51],[78,66,83,53,"formData"],[78,74,83,61],[78,76,83,63],[79,10,84,8,"headers"],[79,17,84,15],[79,19,84,17],[80,12,84,19],[80,26,84,33],[80,28,84,35],[81,10,84,71],[82,8,85,6],[82,9,85,7],[82,10,85,8],[83,8,87,6],[83,14,87,12],[84,10,87,14,"access_token"],[84,22,87,26],[85,10,87,28,"user"],[85,14,87,32],[85,16,87,34,"userData"],[86,8,87,43],[86,9,87,44],[86,12,87,47,"response"],[86,20,87,55],[86,21,87,56,"data"],[86,25,87,60],[87,8,88,6,"setToken"],[87,16,88,14],[87,17,88,15,"access_token"],[87,29,88,27],[87,30,88,28],[88,8,89,6],[88,12,89,6,"setAuthToken"],[88,22,89,18],[88,23,89,18,"setAuthToken"],[88,35,89,18],[88,37,89,19,"access_token"],[88,49,89,31],[88,50,89,32],[89,8,90,6,"setUser"],[89,15,90,13],[89,16,90,14,"userData"],[89,24,90,22],[89,25,90,23],[90,8,92,6],[90,14,92,12,"Promise"],[90,21,92,19],[90,22,92,20,"all"],[90,25,92,23],[90,26,92,24],[90,27,93,8,"AsyncStorage"],[90,39,93,20],[90,40,93,20,"default"],[90,47,93,20],[90,48,93,21,"setItem"],[90,55,93,28],[90,56,93,29,"STORAGE_KEY_TOKEN"],[90,73,93,46],[90,75,93,48,"access_token"],[90,87,93,60],[90,88,93,61],[90,90,94,8,"AsyncStorage"],[90,102,94,20],[90,103,94,20,"default"],[90,110,94,20],[90,111,94,21,"setItem"],[90,118,94,28],[90,119,94,29,"STORAGE_KEY_USER"],[90,135,94,45],[90,137,94,47,"JSON"],[90,141,94,51],[90,142,94,52,"stringify"],[90,151,94,61],[90,152,94,62,"userData"],[90,160,94,70],[90,161,94,71],[90,162,94,72],[90,163,95,7],[90,164,95,8],[91,6,96,4],[91,7,96,5],[91,8,96,6],[91,15,96,13,"error"],[91,20,96,18],[91,22,96,20],[92,8,97,6,"console"],[92,15,97,13],[92,16,97,14,"error"],[92,21,97,19],[92,22,97,20],[92,43,97,41],[92,45,97,43,"error"],[92,50,97,48],[92,51,97,49],[93,8,98,6],[93,14,98,12,"error"],[93,19,98,17],[94,6,99,4],[95,4,100,2],[95,5,100,3],[96,4,102,2],[96,10,102,8,"logout"],[96,16,102,14],[96,19,102,17],[96,25,102,17,"logout"],[96,26,102,17],[96,31,102,29],[97,6,103,4,"setUser"],[97,13,103,11],[97,14,103,12],[97,18,103,16],[97,19,103,17],[98,6,104,4,"setToken"],[98,14,104,12],[98,15,104,13],[98,19,104,17],[98,20,104,18],[99,6,105,4],[99,10,105,4,"setAuthToken"],[99,20,105,16],[99,21,105,16,"setAuthToken"],[99,33,105,16],[99,35,105,17],[99,39,105,21],[99,40,105,22],[100,6,106,4],[100,12,106,10,"Promise"],[100,19,106,17],[100,20,106,18,"all"],[100,23,106,21],[100,24,106,22],[100,25,107,6,"AsyncStorage"],[100,37,107,18],[100,38,107,18,"default"],[100,45,107,18],[100,46,107,19,"removeItem"],[100,56,107,29],[100,57,107,30,"STORAGE_KEY_TOKEN"],[100,74,107,47],[100,75,107,48],[100,77,108,6,"AsyncStorage"],[100,89,108,18],[100,90,108,18,"default"],[100,97,108,18],[100,98,108,19,"removeItem"],[100,108,108,29],[100,109,108,30,"STORAGE_KEY_USER"],[100,125,108,46],[100,126,108,47],[100,127,109,5],[100,128,109,6],[101,4,110,2],[101,5,110,3],[102,4,112,2],[102,10,112,8,"value"],[102,15,112,13],[102,18,112,16],[102,22,112,16,"useMemo"],[102,28,112,23],[102,29,112,23,"useMemo"],[102,36,112,23],[102,38,113,4],[102,45,113,11],[103,6,113,13,"user"],[103,10,113,17],[104,6,113,19,"token"],[104,11,113,24],[105,6,113,26,"loading"],[105,13,113,33],[106,6,113,35,"login"],[106,11,113,40],[107,6,113,42,"logout"],[108,4,113,49],[108,5,113,50],[108,6,113,51],[108,8,114,4],[108,9,114,5,"user"],[108,13,114,9],[108,15,114,11,"token"],[108,20,114,16],[108,22,114,18,"loading"],[108,29,114,25],[108,30,115,2],[108,31,115,3],[109,4,117,2],[109,24,117,9],[109,28,117,9,"_reactJsxDevRuntime"],[109,47,117,9],[109,48,117,9,"jsxDEV"],[109,54,117,9],[109,56,117,10,"AuthContext"],[109,67,117,21],[109,68,117,22,"Provider"],[109,76,117,30],[110,6,117,31,"value"],[110,11,117,36],[110,13,117,38,"value"],[110,18,117,44],[111,6,117,44,"children"],[111,14,117,44],[111,16,117,46,"children"],[112,4,117,54],[113,6,117,54,"fileName"],[113,14,117,54],[113,16,117,54,"_jsxFileName"],[113,28,117,54],[114,6,117,54,"lineNumber"],[114,16,117,54],[115,6,117,54,"columnNumber"],[115,18,117,54],[116,4,117,54],[116,11,117,77],[116,12,117,78],[117,2,118,0],[117,3,118,1],[118,2,120,7],[118,8,120,13,"useAuth"],[118,15,120,20],[118,18,120,23,"useAuth"],[118,19,120,23],[118,24,120,47],[119,4,121,2],[119,10,121,8,"ctx"],[119,13,121,11],[119,16,121,14],[119,20,121,14,"useContext"],[119,26,121,24],[119,27,121,24,"useContext"],[119,37,121,24],[119,39,121,25,"AuthContext"],[119,50,121,36],[119,51,121,37],[120,4,122,2],[120,8,122,6],[120,9,122,7,"ctx"],[120,12,122,10],[120,14,122,12],[121,6,123,4],[121,12,123,10],[121,16,123,14,"Error"],[121,21,123,19],[121,22,123,20],[121,70,123,68],[121,71,123,69],[122,4,124,2],[123,4,125,2],[123,11,125,9,"ctx"],[123,14,125,12],[124,2,126,0],[124,3,126,1],[125,0,126,2],[125,3]],"functionMap":{"names":["<global>","AuthProvider","useEffect$argument_0","init","login","logout","useMemo$argument_0","useAuth"],"mappings":"AAA;qEC+B;YCK;iBCC;KDiC;GDG;gBGE;GHwB;iBIE;GJQ;IKG,+CL;CDK;uBOE;CPM"},"hasCjsExports":false},"type":"js/module"}]}