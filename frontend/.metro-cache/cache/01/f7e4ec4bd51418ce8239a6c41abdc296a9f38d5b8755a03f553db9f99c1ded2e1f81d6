{"dependencies":[{"name":"react","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":1,"column":0,"index":0},"end":{"line":1,"column":87,"index":87}}],"key":"RtGiGa+/H7VrI7GDQDLhO1UbpU8=","exportNames":["*"],"imports":1}},{"name":"@react-native-async-storage/async-storage","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":2,"column":0,"index":88},"end":{"line":2,"column":69,"index":157}}],"key":"0kSRlooyBOaYM9tlTtK91nq+uds=","exportNames":["*"],"imports":1}},{"name":"../api/client","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":3,"column":0,"index":158},"end":{"line":3,"column":50,"index":208}}],"key":"vrY6iF+Nd2CrRu9d6eBxeX1BPiA=","exportNames":["*"],"imports":1}},{"name":"react/jsx-dev-runtime","data":{"asyncType":null,"isESMImport":false,"locs":[],"key":"L9D70Z4hi4aGuui1ysja/oQ5ytI=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  var _jsxFileName = \"/app/frontend/src/context/AuthContext.tsx\";\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n  function _interopDefault(e) {\n    return e && e.__esModule ? e : {\n      default: e\n    };\n  }\n  Object.defineProperty(exports, \"AuthProvider\", {\n    enumerable: true,\n    get: function () {\n      return AuthProvider;\n    }\n  });\n  Object.defineProperty(exports, \"useAuth\", {\n    enumerable: true,\n    get: function () {\n      return useAuth;\n    }\n  });\n  var _react = require(_dependencyMap[0], \"react\");\n  var _reactNativeAsyncStorageAsyncStorage = require(_dependencyMap[1], \"@react-native-async-storage/async-storage\");\n  var AsyncStorage = _interopDefault(_reactNativeAsyncStorageAsyncStorage);\n  var _apiClient = require(_dependencyMap[2], \"../api/client\");\n  var _reactJsxDevRuntime = require(_dependencyMap[3], \"react/jsx-dev-runtime\");\n  const AuthContext = /*#__PURE__*/(0, _react.createContext)(undefined);\n  const STORAGE_KEY_TOKEN = \"meatsafe_token\";\n  const STORAGE_KEY_USER = \"meatsafe_user\";\n  const AuthProvider = ({\n    children\n  }) => {\n    const [user, setUser] = (0, _react.useState)(null);\n    const [token, setToken] = (0, _react.useState)(null);\n    const [loading, setLoading] = (0, _react.useState)(true);\n    (0, _react.useEffect)(() => {\n      const init = async () => {\n        try {\n          const [storedToken, storedUser] = await Promise.all([AsyncStorage.default.getItem(STORAGE_KEY_TOKEN), AsyncStorage.default.getItem(STORAGE_KEY_USER)]);\n          if (storedToken && storedUser) {\n            // Tenter de valider le token auprès du backend\n            (0, _apiClient.setAuthToken)(storedToken);\n            try {\n              const meRes = await _apiClient.api.get(\"/users/me\");\n              const userData = meRes.data;\n              setToken(storedToken);\n              setUser(userData);\n              await AsyncStorage.default.setItem(STORAGE_KEY_USER, JSON.stringify(userData));\n            } catch (e) {\n              // Token invalide ou backend injoignable: forcer la reconnexion\n              console.warn(\"Token invalide ou expiré, nettoyage de la session\", e);\n              setToken(null);\n              setUser(null);\n              (0, _apiClient.setAuthToken)(null);\n              await Promise.all([AsyncStorage.default.removeItem(STORAGE_KEY_TOKEN), AsyncStorage.default.removeItem(STORAGE_KEY_USER)]);\n            }\n          }\n        } catch (error) {\n          console.warn(\"Erreur lors du chargement du token\", error);\n        } finally {\n          setLoading(false);\n        }\n      };\n      void init();\n    }, []);\n    const login = async ({\n      email,\n      password\n    }) => {\n      try {\n        const formData = new URLSearchParams();\n        formData.append(\"username\", email);\n        formData.append(\"password\", password);\n        const response = await _apiClient.api.post(\"/auth/login\", formData.toString(), {\n          headers: {\n            \"Content-Type\": \"application/x-www-form-urlencoded\"\n          }\n        });\n        const {\n          access_token,\n          user: userData\n        } = response.data;\n        setToken(access_token);\n        (0, _apiClient.setAuthToken)(access_token);\n        setUser(userData);\n        await Promise.all([AsyncStorage.default.setItem(STORAGE_KEY_TOKEN, access_token), AsyncStorage.default.setItem(STORAGE_KEY_USER, JSON.stringify(userData))]);\n      } catch (error) {\n        console.error(\"Erreur de connexion\", error);\n        throw error;\n      }\n    };\n    const logout = async () => {\n      setUser(null);\n      setToken(null);\n      (0, _apiClient.setAuthToken)(null);\n      await Promise.all([AsyncStorage.default.removeItem(STORAGE_KEY_TOKEN), AsyncStorage.default.removeItem(STORAGE_KEY_USER)]);\n    };\n    const value = (0, _react.useMemo)(() => ({\n      user,\n      token,\n      loading,\n      login,\n      logout\n    }), [user, token, loading]);\n    return /*#__PURE__*/(0, _reactJsxDevRuntime.jsxDEV)(AuthContext.Provider, {\n      value: value,\n      children: children\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 116,\n      columnNumber: 10\n    }, this);\n  };\n  const useAuth = () => {\n    const ctx = (0, _react.useContext)(AuthContext);\n    if (!ctx) {\n      throw new Error(\"useAuth doit être utilisé dans un AuthProvider\");\n    }\n    return ctx;\n  };\n});","lineCount":124,"map":[[13,2,32,0,"Object"],[13,8,32,0],[13,9,32,0,"defineProperty"],[13,23,32,0],[13,24,32,0,"exports"],[13,31,32,0],[14,4,32,0,"enumerable"],[14,14,32,0],[15,4,32,0,"get"],[15,7,32,0],[15,18,32,0,"get"],[15,19,32,0],[16,6,32,0],[16,13,32,0,"AuthProvider"],[16,25,32,0],[17,4,32,0],[18,2,32,0],[19,2,119,0,"Object"],[19,8,119,0],[19,9,119,0,"defineProperty"],[19,23,119,0],[19,24,119,0,"exports"],[19,31,119,0],[20,4,119,0,"enumerable"],[20,14,119,0],[21,4,119,0,"get"],[21,7,119,0],[21,18,119,0,"get"],[21,19,119,0],[22,6,119,0],[22,13,119,0,"useAuth"],[22,20,119,0],[23,4,119,0],[24,2,119,0],[25,2,1,0],[25,6,1,0,"_react"],[25,12,1,0],[25,15,1,0,"require"],[25,22,1,0],[25,23,1,0,"_dependencyMap"],[25,37,1,0],[26,2,2,0],[26,6,2,0,"_reactNativeAsyncStorageAsyncStorage"],[26,42,2,0],[26,45,2,0,"require"],[26,52,2,0],[26,53,2,0,"_dependencyMap"],[26,67,2,0],[27,2,2,0],[27,6,2,0,"AsyncStorage"],[27,18,2,0],[27,21,2,0,"_interopDefault"],[27,36,2,0],[27,37,2,0,"_reactNativeAsyncStorageAsyncStorage"],[27,73,2,0],[28,2,3,0],[28,6,3,0,"_apiClient"],[28,16,3,0],[28,19,3,0,"require"],[28,26,3,0],[28,27,3,0,"_dependencyMap"],[28,41,3,0],[29,2,3,50],[29,6,3,50,"_reactJsxDevRuntime"],[29,25,3,50],[29,28,3,50,"require"],[29,35,3,50],[29,36,3,50,"_dependencyMap"],[29,50,3,50],[30,2,27,0],[30,8,27,6,"AuthContext"],[30,19,27,17],[30,35,27,20],[30,39,27,20,"createContext"],[30,45,27,33],[30,46,27,33,"createContext"],[30,59,27,33],[30,61,27,64,"undefined"],[30,70,27,73],[30,71,27,74],[31,2,29,0],[31,8,29,6,"STORAGE_KEY_TOKEN"],[31,25,29,23],[31,28,29,26],[31,44,29,42],[32,2,30,0],[32,8,30,6,"STORAGE_KEY_USER"],[32,24,30,22],[32,27,30,25],[32,42,30,40],[33,2,32,7],[33,8,32,13,"AuthProvider"],[33,20,32,66],[33,23,32,69,"AuthProvider"],[33,24,32,70],[34,4,32,72,"children"],[35,2,32,81],[35,3,32,82],[35,8,32,87],[36,4,33,2],[36,10,33,8],[36,11,33,9,"user"],[36,15,33,13],[36,17,33,15,"setUser"],[36,24,33,22],[36,25,33,23],[36,28,33,26],[36,32,33,26,"useState"],[36,38,33,34],[36,39,33,34,"useState"],[36,47,33,34],[36,49,33,52],[36,53,33,56],[36,54,33,57],[37,4,34,2],[37,10,34,8],[37,11,34,9,"token"],[37,16,34,14],[37,18,34,16,"setToken"],[37,26,34,24],[37,27,34,25],[37,30,34,28],[37,34,34,28,"useState"],[37,40,34,36],[37,41,34,36,"useState"],[37,49,34,36],[37,51,34,52],[37,55,34,56],[37,56,34,57],[38,4,35,2],[38,10,35,8],[38,11,35,9,"loading"],[38,18,35,16],[38,20,35,18,"setLoading"],[38,30,35,28],[38,31,35,29],[38,34,35,32],[38,38,35,32,"useState"],[38,44,35,40],[38,45,35,40,"useState"],[38,53,35,40],[38,55,35,41],[38,59,35,45],[38,60,35,46],[39,4,37,2],[39,8,37,2,"useEffect"],[39,14,37,11],[39,15,37,11,"useEffect"],[39,24,37,11],[39,26,37,12],[39,32,37,18],[40,6,38,4],[40,12,38,10,"init"],[40,16,38,14],[40,19,38,17],[40,25,38,17,"init"],[40,26,38,17],[40,31,38,29],[41,8,39,6],[41,12,39,10],[42,10,40,8],[42,16,40,14],[42,17,40,15,"storedToken"],[42,28,40,26],[42,30,40,28,"storedUser"],[42,40,40,38],[42,41,40,39],[42,44,40,42],[42,50,40,48,"Promise"],[42,57,40,55],[42,58,40,56,"all"],[42,61,40,59],[42,62,40,60],[42,63,41,10,"AsyncStorage"],[42,75,41,22],[42,76,41,22,"default"],[42,83,41,22],[42,84,41,23,"getItem"],[42,91,41,30],[42,92,41,31,"STORAGE_KEY_TOKEN"],[42,109,41,48],[42,110,41,49],[42,112,42,10,"AsyncStorage"],[42,124,42,22],[42,125,42,22,"default"],[42,132,42,22],[42,133,42,23,"getItem"],[42,140,42,30],[42,141,42,31,"STORAGE_KEY_USER"],[42,157,42,47],[42,158,42,48],[42,159,43,9],[42,160,43,10],[43,10,45,8],[43,14,45,12,"storedToken"],[43,25,45,23],[43,29,45,27,"storedUser"],[43,39,45,37],[43,41,45,39],[44,12,46,10],[45,12,47,10],[45,16,47,10,"setAuthToken"],[45,26,47,22],[45,27,47,22,"setAuthToken"],[45,39,47,22],[45,41,47,23,"storedToken"],[45,52,47,34],[45,53,47,35],[46,12,48,10],[46,16,48,14],[47,14,49,12],[47,20,49,18,"meRes"],[47,25,49,23],[47,28,49,26],[47,34,49,32,"api"],[47,44,49,35],[47,45,49,35,"api"],[47,48,49,35],[47,49,49,36,"get"],[47,52,49,39],[47,53,49,40],[47,64,49,51],[47,65,49,52],[48,14,50,12],[48,20,50,18,"userData"],[48,28,50,26],[48,31,50,29,"meRes"],[48,36,50,34],[48,37,50,35,"data"],[48,41,50,51],[49,14,51,12,"setToken"],[49,22,51,20],[49,23,51,21,"storedToken"],[49,34,51,32],[49,35,51,33],[50,14,52,12,"setUser"],[50,21,52,19],[50,22,52,20,"userData"],[50,30,52,28],[50,31,52,29],[51,14,53,12],[51,20,53,18,"AsyncStorage"],[51,32,53,30],[51,33,53,30,"default"],[51,40,53,30],[51,41,53,31,"setItem"],[51,48,53,38],[51,49,53,39,"STORAGE_KEY_USER"],[51,65,53,55],[51,67,53,57,"JSON"],[51,71,53,61],[51,72,53,62,"stringify"],[51,81,53,71],[51,82,53,72,"userData"],[51,90,53,80],[51,91,53,81],[51,92,53,82],[52,12,54,10],[52,13,54,11],[52,14,54,12],[52,21,54,19,"e"],[52,22,54,20],[52,24,54,22],[53,14,55,12],[54,14,56,12,"console"],[54,21,56,19],[54,22,56,20,"warn"],[54,26,56,24],[54,27,56,25],[54,78,56,76],[54,80,56,78,"e"],[54,81,56,79],[54,82,56,80],[55,14,57,12,"setToken"],[55,22,57,20],[55,23,57,21],[55,27,57,25],[55,28,57,26],[56,14,58,12,"setUser"],[56,21,58,19],[56,22,58,20],[56,26,58,24],[56,27,58,25],[57,14,59,12],[57,18,59,12,"setAuthToken"],[57,28,59,24],[57,29,59,24,"setAuthToken"],[57,41,59,24],[57,43,59,25],[57,47,59,29],[57,48,59,30],[58,14,60,12],[58,20,60,18,"Promise"],[58,27,60,25],[58,28,60,26,"all"],[58,31,60,29],[58,32,60,30],[58,33,61,14,"AsyncStorage"],[58,45,61,26],[58,46,61,26,"default"],[58,53,61,26],[58,54,61,27,"removeItem"],[58,64,61,37],[58,65,61,38,"STORAGE_KEY_TOKEN"],[58,82,61,55],[58,83,61,56],[58,85,62,14,"AsyncStorage"],[58,97,62,26],[58,98,62,26,"default"],[58,105,62,26],[58,106,62,27,"removeItem"],[58,116,62,37],[58,117,62,38,"STORAGE_KEY_USER"],[58,133,62,54],[58,134,62,55],[58,135,63,13],[58,136,63,14],[59,12,64,10],[60,10,65,8],[61,8,66,6],[61,9,66,7],[61,10,66,8],[61,17,66,15,"error"],[61,22,66,20],[61,24,66,22],[62,10,67,8,"console"],[62,17,67,15],[62,18,67,16,"warn"],[62,22,67,20],[62,23,67,21],[62,59,67,57],[62,61,67,59,"error"],[62,66,67,64],[62,67,67,65],[63,8,68,6],[63,9,68,7],[63,18,68,16],[64,10,69,8,"setLoading"],[64,20,69,18],[64,21,69,19],[64,26,69,24],[64,27,69,25],[65,8,70,6],[66,6,71,4],[66,7,71,5],[67,6,73,4],[67,11,73,9,"init"],[67,15,73,13],[67,16,73,14],[67,17,73,15],[68,4,74,2],[68,5,74,3],[68,7,74,5],[68,9,74,7],[68,10,74,8],[69,4,76,2],[69,10,76,8,"login"],[69,15,76,13],[69,18,76,16],[69,24,76,16,"login"],[69,25,76,23],[70,6,76,25,"email"],[70,11,76,30],[71,6,76,32,"password"],[72,4,76,54],[72,5,76,55],[72,10,76,60],[73,6,77,4],[73,10,77,8],[74,8,78,6],[74,14,78,12,"formData"],[74,22,78,20],[74,25,78,23],[74,29,78,27,"URLSearchParams"],[74,44,78,42],[74,45,78,43],[74,46,78,44],[75,8,79,6,"formData"],[75,16,79,14],[75,17,79,15,"append"],[75,23,79,21],[75,24,79,22],[75,34,79,32],[75,36,79,34,"email"],[75,41,79,39],[75,42,79,40],[76,8,80,6,"formData"],[76,16,80,14],[76,17,80,15,"append"],[76,23,80,21],[76,24,80,22],[76,34,80,32],[76,36,80,34,"password"],[76,44,80,42],[76,45,80,43],[77,8,82,6],[77,14,82,12,"response"],[77,22,82,20],[77,25,82,23],[77,31,82,29,"api"],[77,41,82,32],[77,42,82,32,"api"],[77,45,82,32],[77,46,82,33,"post"],[77,50,82,37],[77,51,82,38],[77,64,82,51],[77,66,82,53,"formData"],[77,74,82,61],[77,75,82,62,"toString"],[77,83,82,70],[77,84,82,71],[77,85,82,72],[77,87,82,74],[78,10,83,8,"headers"],[78,17,83,15],[78,19,83,17],[79,12,83,19],[79,26,83,33],[79,28,83,35],[80,10,83,71],[81,8,84,6],[81,9,84,7],[81,10,84,8],[82,8,86,6],[82,14,86,12],[83,10,86,14,"access_token"],[83,22,86,26],[84,10,86,28,"user"],[84,14,86,32],[84,16,86,34,"userData"],[85,8,86,43],[85,9,86,44],[85,12,86,47,"response"],[85,20,86,55],[85,21,86,56,"data"],[85,25,86,60],[86,8,87,6,"setToken"],[86,16,87,14],[86,17,87,15,"access_token"],[86,29,87,27],[86,30,87,28],[87,8,88,6],[87,12,88,6,"setAuthToken"],[87,22,88,18],[87,23,88,18,"setAuthToken"],[87,35,88,18],[87,37,88,19,"access_token"],[87,49,88,31],[87,50,88,32],[88,8,89,6,"setUser"],[88,15,89,13],[88,16,89,14,"userData"],[88,24,89,22],[88,25,89,23],[89,8,91,6],[89,14,91,12,"Promise"],[89,21,91,19],[89,22,91,20,"all"],[89,25,91,23],[89,26,91,24],[89,27,92,8,"AsyncStorage"],[89,39,92,20],[89,40,92,20,"default"],[89,47,92,20],[89,48,92,21,"setItem"],[89,55,92,28],[89,56,92,29,"STORAGE_KEY_TOKEN"],[89,73,92,46],[89,75,92,48,"access_token"],[89,87,92,60],[89,88,92,61],[89,90,93,8,"AsyncStorage"],[89,102,93,20],[89,103,93,20,"default"],[89,110,93,20],[89,111,93,21,"setItem"],[89,118,93,28],[89,119,93,29,"STORAGE_KEY_USER"],[89,135,93,45],[89,137,93,47,"JSON"],[89,141,93,51],[89,142,93,52,"stringify"],[89,151,93,61],[89,152,93,62,"userData"],[89,160,93,70],[89,161,93,71],[89,162,93,72],[89,163,94,7],[89,164,94,8],[90,6,95,4],[90,7,95,5],[90,8,95,6],[90,15,95,13,"error"],[90,20,95,18],[90,22,95,20],[91,8,96,6,"console"],[91,15,96,13],[91,16,96,14,"error"],[91,21,96,19],[91,22,96,20],[91,43,96,41],[91,45,96,43,"error"],[91,50,96,48],[91,51,96,49],[92,8,97,6],[92,14,97,12,"error"],[92,19,97,17],[93,6,98,4],[94,4,99,2],[94,5,99,3],[95,4,101,2],[95,10,101,8,"logout"],[95,16,101,14],[95,19,101,17],[95,25,101,17,"logout"],[95,26,101,17],[95,31,101,29],[96,6,102,4,"setUser"],[96,13,102,11],[96,14,102,12],[96,18,102,16],[96,19,102,17],[97,6,103,4,"setToken"],[97,14,103,12],[97,15,103,13],[97,19,103,17],[97,20,103,18],[98,6,104,4],[98,10,104,4,"setAuthToken"],[98,20,104,16],[98,21,104,16,"setAuthToken"],[98,33,104,16],[98,35,104,17],[98,39,104,21],[98,40,104,22],[99,6,105,4],[99,12,105,10,"Promise"],[99,19,105,17],[99,20,105,18,"all"],[99,23,105,21],[99,24,105,22],[99,25,106,6,"AsyncStorage"],[99,37,106,18],[99,38,106,18,"default"],[99,45,106,18],[99,46,106,19,"removeItem"],[99,56,106,29],[99,57,106,30,"STORAGE_KEY_TOKEN"],[99,74,106,47],[99,75,106,48],[99,77,107,6,"AsyncStorage"],[99,89,107,18],[99,90,107,18,"default"],[99,97,107,18],[99,98,107,19,"removeItem"],[99,108,107,29],[99,109,107,30,"STORAGE_KEY_USER"],[99,125,107,46],[99,126,107,47],[99,127,108,5],[99,128,108,6],[100,4,109,2],[100,5,109,3],[101,4,111,2],[101,10,111,8,"value"],[101,15,111,13],[101,18,111,16],[101,22,111,16,"useMemo"],[101,28,111,23],[101,29,111,23,"useMemo"],[101,36,111,23],[101,38,112,4],[101,45,112,11],[102,6,112,13,"user"],[102,10,112,17],[103,6,112,19,"token"],[103,11,112,24],[104,6,112,26,"loading"],[104,13,112,33],[105,6,112,35,"login"],[105,11,112,40],[106,6,112,42,"logout"],[107,4,112,49],[107,5,112,50],[107,6,112,51],[107,8,113,4],[107,9,113,5,"user"],[107,13,113,9],[107,15,113,11,"token"],[107,20,113,16],[107,22,113,18,"loading"],[107,29,113,25],[107,30,114,2],[107,31,114,3],[108,4,116,2],[108,24,116,9],[108,28,116,9,"_reactJsxDevRuntime"],[108,47,116,9],[108,48,116,9,"jsxDEV"],[108,54,116,9],[108,56,116,10,"AuthContext"],[108,67,116,21],[108,68,116,22,"Provider"],[108,76,116,30],[109,6,116,31,"value"],[109,11,116,36],[109,13,116,38,"value"],[109,18,116,44],[110,6,116,44,"children"],[110,14,116,44],[110,16,116,46,"children"],[111,4,116,54],[112,6,116,54,"fileName"],[112,14,116,54],[112,16,116,54,"_jsxFileName"],[112,28,116,54],[113,6,116,54,"lineNumber"],[113,16,116,54],[114,6,116,54,"columnNumber"],[114,18,116,54],[115,4,116,54],[115,11,116,77],[115,12,116,78],[116,2,117,0],[116,3,117,1],[117,2,119,7],[117,8,119,13,"useAuth"],[117,15,119,20],[117,18,119,23,"useAuth"],[117,19,119,23],[117,24,119,47],[118,4,120,2],[118,10,120,8,"ctx"],[118,13,120,11],[118,16,120,14],[118,20,120,14,"useContext"],[118,26,120,24],[118,27,120,24,"useContext"],[118,37,120,24],[118,39,120,25,"AuthContext"],[118,50,120,36],[118,51,120,37],[119,4,121,2],[119,8,121,6],[119,9,121,7,"ctx"],[119,12,121,10],[119,14,121,12],[120,6,122,4],[120,12,122,10],[120,16,122,14,"Error"],[120,21,122,19],[120,22,122,20],[120,70,122,68],[120,71,122,69],[121,4,123,2],[122,4,124,2],[122,11,124,9,"ctx"],[122,14,124,12],[123,2,125,0],[123,3,125,1],[124,0,125,2],[124,3]],"functionMap":{"names":["<global>","AuthProvider","useEffect$argument_0","init","login","logout","useMemo$argument_0","useAuth"],"mappings":"AAA;qEC+B;YCK;iBCC;KDiC;GDG;gBGE;GHuB;iBIE;GJQ;IKG,+CL;CDK;uBOE;CPM"},"hasCjsExports":false},"type":"js/module"}]}