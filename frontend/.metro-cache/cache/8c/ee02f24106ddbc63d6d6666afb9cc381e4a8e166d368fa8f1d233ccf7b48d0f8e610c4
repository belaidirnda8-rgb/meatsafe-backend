{"dependencies":[{"name":"@babel/runtime/helpers/asyncToGenerator","data":{"asyncType":null,"isESMImport":false,"locs":[],"key":"YisBBiy2Xm9DEVdFebZ2nbgAHBo=","exportNames":["*"],"imports":1}},{"name":"zustand","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":1,"column":0,"index":0},"end":{"line":1,"column":29,"index":29}}],"key":"POPvx7yS3Y3wz+S/9OAefiXNs0Q=","exportNames":["*"],"imports":1}},{"name":"@react-native-async-storage/async-storage","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":2,"column":0,"index":30},"end":{"line":2,"column":69,"index":99}}],"key":"0kSRlooyBOaYM9tlTtK91nq+uds=","exportNames":["*"],"imports":1}},{"name":"@react-native-community/netinfo","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":3,"column":0,"index":100},"end":{"line":3,"column":54,"index":154}}],"key":"PqZcYTlMIVnzFjdViPzMiGUu7Hg=","exportNames":["*"],"imports":1}},{"name":"../api/inspector","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":4,"column":0,"index":155},"end":{"line":4,"column":71,"index":226}}],"key":"hXkUgtl2ZlL9RLsQw35xpd7L9gw=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n  function _interopDefault(e) {\n    return e && e.__esModule ? e : {\n      default: e\n    };\n  }\n  Object.defineProperty(exports, \"useOfflineQueue\", {\n    enumerable: true,\n    get: function () {\n      return useOfflineQueue;\n    }\n  });\n  var _babelRuntimeHelpersAsyncToGenerator = require(_dependencyMap[0], \"@babel/runtime/helpers/asyncToGenerator\");\n  var _asyncToGenerator = _interopDefault(_babelRuntimeHelpersAsyncToGenerator);\n  var _zustand = require(_dependencyMap[1], \"zustand\");\n  var create = _interopDefault(_zustand);\n  var _reactNativeAsyncStorageAsyncStorage = require(_dependencyMap[2], \"@react-native-async-storage/async-storage\");\n  var AsyncStorage = _interopDefault(_reactNativeAsyncStorageAsyncStorage);\n  var _reactNativeCommunityNetinfo = require(_dependencyMap[3], \"@react-native-community/netinfo\");\n  var NetInfo = _interopDefault(_reactNativeCommunityNetinfo);\n  var _apiInspector = require(_dependencyMap[4], \"../api/inspector\");\n  var STORAGE_KEY = \"meatsafe_offline_seizures\";\n  var useOfflineQueue = (0, create.default)((set, get) => {\n    // Abonnement réseau\n    NetInfo.default.addEventListener(state => {\n      var online = !!state.isConnected && !!state.isInternetReachable;\n      set({\n        isOnline: online\n      });\n      if (online) {\n        void get().syncAll();\n      }\n    });\n    var loadFromStorage = /*#__PURE__*/function () {\n      var _ref = (0, _asyncToGenerator.default)(function* () {\n        try {\n          var stored = yield AsyncStorage.default.getItem(STORAGE_KEY);\n          if (stored) {\n            var parsed = JSON.parse(stored);\n            set({\n              items: parsed\n            });\n          }\n        } catch (e) {\n          // ignore pour MVP\n        }\n      });\n      return function loadFromStorage() {\n        return _ref.apply(this, arguments);\n      };\n    }();\n    var persist = /*#__PURE__*/function () {\n      var _ref2 = (0, _asyncToGenerator.default)(function* (items) {\n        try {\n          yield AsyncStorage.default.setItem(STORAGE_KEY, JSON.stringify(items));\n        } catch (e) {\n          // ignore\n        }\n      });\n      return function persist(_x) {\n        return _ref2.apply(this, arguments);\n      };\n    }();\n    var addPending = payload => {\n      var localId = `local-${Date.now()}-${Math.random().toString(36).slice(2, 8)}`;\n      var newItem = {\n        localId,\n        payload,\n        status: \"pending\"\n      };\n      set(state => {\n        var next = [...state.items, newItem];\n        void persist(next);\n        return {\n          items: next\n        };\n      });\n    };\n    var markSynced = localId => {\n      set(state => {\n        var next = state.items.filter(i => i.localId !== localId);\n        void persist(next);\n        return {\n          items: next\n        };\n      });\n    };\n    var markFailed = (localId, error) => {\n      set(state => {\n        var next = state.items.map(i => i.localId === localId ? {\n          ...i,\n          status: \"failed\",\n          error\n        } : i);\n        void persist(next);\n        return {\n          items: next\n        };\n      });\n    };\n    var syncAll = /*#__PURE__*/function () {\n      var _ref3 = (0, _asyncToGenerator.default)(function* () {\n        var _get = get(),\n          items = _get.items;\n        for (var item of items) {\n          if (item.status !== \"pending\") continue;\n          try {\n            yield (0, _apiInspector.createSeizure)(item.payload);\n            get().markSynced(item.localId);\n          } catch (e) {\n            get().markFailed(item.localId, \"Erreur de synchronisation\");\n          }\n        }\n      });\n      return function syncAll() {\n        return _ref3.apply(this, arguments);\n      };\n    }();\n\n    // état initial\n    void loadFromStorage();\n    return {\n      items: [],\n      isOnline: true,\n      addPending,\n      markSynced,\n      markFailed,\n      loadFromStorage,\n      syncAll\n    };\n  });\n});","lineCount":137,"map":[[12,2,27,0,"Object"],[12,8,27,0],[12,9,27,0,"defineProperty"],[12,23,27,0],[12,24,27,0,"exports"],[12,31,27,0],[13,4,27,0,"enumerable"],[13,14,27,0],[14,4,27,0,"get"],[14,7,27,0],[14,18,27,0,"get"],[14,19,27,0],[15,6,27,0],[15,13,27,0,"useOfflineQueue"],[15,28,27,0],[16,4,27,0],[17,2,27,0],[18,2,114,3],[18,6,114,3,"_babelRuntimeHelpersAsyncToGenerator"],[18,42,114,3],[18,45,114,3,"require"],[18,52,114,3],[18,53,114,3,"_dependencyMap"],[18,67,114,3],[19,2,114,3],[19,6,114,3,"_asyncToGenerator"],[19,23,114,3],[19,26,114,3,"_interopDefault"],[19,41,114,3],[19,42,114,3,"_babelRuntimeHelpersAsyncToGenerator"],[19,78,114,3],[20,2,1,0],[20,6,1,0,"_zustand"],[20,14,1,0],[20,17,1,0,"require"],[20,24,1,0],[20,25,1,0,"_dependencyMap"],[20,39,1,0],[21,2,1,0],[21,6,1,0,"create"],[21,12,1,0],[21,15,1,0,"_interopDefault"],[21,30,1,0],[21,31,1,0,"_zustand"],[21,39,1,0],[22,2,2,0],[22,6,2,0,"_reactNativeAsyncStorageAsyncStorage"],[22,42,2,0],[22,45,2,0,"require"],[22,52,2,0],[22,53,2,0,"_dependencyMap"],[22,67,2,0],[23,2,2,0],[23,6,2,0,"AsyncStorage"],[23,18,2,0],[23,21,2,0,"_interopDefault"],[23,36,2,0],[23,37,2,0,"_reactNativeAsyncStorageAsyncStorage"],[23,73,2,0],[24,2,3,0],[24,6,3,0,"_reactNativeCommunityNetinfo"],[24,34,3,0],[24,37,3,0,"require"],[24,44,3,0],[24,45,3,0,"_dependencyMap"],[24,59,3,0],[25,2,3,0],[25,6,3,0,"NetInfo"],[25,13,3,0],[25,16,3,0,"_interopDefault"],[25,31,3,0],[25,32,3,0,"_reactNativeCommunityNetinfo"],[25,60,3,0],[26,2,4,0],[26,6,4,0,"_apiInspector"],[26,19,4,0],[26,22,4,0,"require"],[26,29,4,0],[26,30,4,0,"_dependencyMap"],[26,44,4,0],[27,2,25,0],[27,6,25,6,"STORAGE_KEY"],[27,17,25,17],[27,20,25,20],[27,47,25,47],[28,2,27,7],[28,6,27,13,"useOfflineQueue"],[28,21,27,28],[28,24,27,31],[28,28,27,31,"create"],[28,34,27,37],[28,35,27,37,"default"],[28,42,27,37],[28,44,27,57],[28,45,27,58,"set"],[28,48,27,61],[28,50,27,63,"get"],[28,53,27,66],[28,58,27,71],[29,4,28,2],[30,4,29,2,"NetInfo"],[30,11,29,9],[30,12,29,9,"default"],[30,19,29,9],[30,20,29,10,"addEventListener"],[30,36,29,26],[30,37,29,28,"state"],[30,42,29,33],[30,46,29,38],[31,6,30,4],[31,10,30,10,"online"],[31,16,30,16],[31,19,30,19],[31,20,30,20],[31,21,30,21,"state"],[31,26,30,26],[31,27,30,27,"isConnected"],[31,38,30,38],[31,42,30,42],[31,43,30,43],[31,44,30,44,"state"],[31,49,30,49],[31,50,30,50,"isInternetReachable"],[31,69,30,69],[32,6,31,4,"set"],[32,9,31,7],[32,10,31,8],[33,8,31,10,"isOnline"],[33,16,31,18],[33,18,31,20,"online"],[34,6,31,27],[34,7,31,28],[34,8,31,29],[35,6,32,4],[35,10,32,8,"online"],[35,16,32,14],[35,18,32,16],[36,8,33,6],[36,13,33,11,"get"],[36,16,33,14],[36,17,33,15],[36,18,33,16],[36,19,33,17,"syncAll"],[36,26,33,24],[36,27,33,25],[36,28,33,26],[37,6,34,4],[38,4,35,2],[38,5,35,3],[38,6,35,4],[39,4,37,2],[39,8,37,8,"loadFromStorage"],[39,23,37,23],[40,6,37,23],[40,10,37,23,"_ref"],[40,14,37,23],[40,21,37,23,"_asyncToGenerator"],[40,38,37,23],[40,39,37,23,"default"],[40,46,37,23],[40,48,37,26],[40,61,37,38],[41,8,38,4],[41,12,38,8],[42,10,39,6],[42,14,39,12,"stored"],[42,20,39,18],[42,29,39,27,"AsyncStorage"],[42,41,39,39],[42,42,39,39,"default"],[42,49,39,39],[42,50,39,40,"getItem"],[42,57,39,47],[42,58,39,48,"STORAGE_KEY"],[42,69,39,59],[42,70,39,60],[43,10,40,6],[43,14,40,10,"stored"],[43,20,40,16],[43,22,40,18],[44,12,41,8],[44,16,41,14,"parsed"],[44,22,41,38],[44,25,41,41,"JSON"],[44,29,41,45],[44,30,41,46,"parse"],[44,35,41,51],[44,36,41,52,"stored"],[44,42,41,58],[44,43,41,59],[45,12,42,8,"set"],[45,15,42,11],[45,16,42,12],[46,14,42,14,"items"],[46,19,42,19],[46,21,42,21,"parsed"],[47,12,42,28],[47,13,42,29],[47,14,42,30],[48,10,43,6],[49,8,44,4],[49,9,44,5],[49,10,44,6],[49,17,44,13,"e"],[49,18,44,14],[49,20,44,16],[50,10,45,6],[51,8,45,6],[52,6,47,2],[52,7,47,3],[53,6,47,3],[53,22,37,8,"loadFromStorage"],[53,37,37,23,"loadFromStorage"],[53,38,37,23],[54,8,37,23],[54,15,37,23,"_ref"],[54,19,37,23],[54,20,37,23,"apply"],[54,25,37,23],[54,32,37,23,"arguments"],[54,41,37,23],[55,6,37,23],[56,4,37,23],[56,7,47,3],[57,4,49,2],[57,8,49,8,"persist"],[57,15,49,15],[58,6,49,15],[58,10,49,15,"_ref2"],[58,15,49,15],[58,22,49,15,"_asyncToGenerator"],[58,39,49,15],[58,40,49,15,"default"],[58,47,49,15],[58,49,49,18],[58,60,49,25,"items"],[58,65,49,48],[58,67,49,53],[59,8,50,4],[59,12,50,8],[60,10,51,6],[60,16,51,12,"AsyncStorage"],[60,28,51,24],[60,29,51,24,"default"],[60,36,51,24],[60,37,51,25,"setItem"],[60,44,51,32],[60,45,51,33,"STORAGE_KEY"],[60,56,51,44],[60,58,51,46,"JSON"],[60,62,51,50],[60,63,51,51,"stringify"],[60,72,51,60],[60,73,51,61,"items"],[60,78,51,66],[60,79,51,67],[60,80,51,68],[61,8,52,4],[61,9,52,5],[61,10,52,6],[61,17,52,13,"e"],[61,18,52,14],[61,20,52,16],[62,10,53,6],[63,8,53,6],[64,6,55,2],[64,7,55,3],[65,6,55,3],[65,22,49,8,"persist"],[65,29,49,15,"persist"],[65,30,49,15,"_x"],[65,32,49,15],[66,8,49,15],[66,15,49,15,"_ref2"],[66,20,49,15],[66,21,49,15,"apply"],[66,26,49,15],[66,33,49,15,"arguments"],[66,42,49,15],[67,6,49,15],[68,4,49,15],[68,7,55,3],[69,4,57,2],[69,8,57,8,"addPending"],[69,18,57,18],[69,21,57,22,"payload"],[69,28,57,51],[69,32,57,56],[70,6,58,4],[70,10,58,10,"localId"],[70,17,58,17],[70,20,58,20],[70,29,58,29,"Date"],[70,33,58,33],[70,34,58,34,"now"],[70,37,58,37],[70,38,58,38],[70,39,58,39],[70,43,58,43,"Math"],[70,47,58,47],[70,48,58,48,"random"],[70,54,58,54],[70,55,58,55],[70,56,58,56],[70,57,58,57,"toString"],[70,65,58,65],[70,66,58,66],[70,68,58,68],[70,69,58,69],[70,70,58,70,"slice"],[70,75,58,75],[70,76,58,76],[70,77,58,77],[70,79,58,79],[70,80,58,80],[70,81,58,81],[70,83,58,83],[71,6,59,4],[71,10,59,10,"newItem"],[71,17,59,33],[71,20,59,36],[72,8,60,6,"localId"],[72,15,60,13],[73,8,61,6,"payload"],[73,15,61,13],[74,8,62,6,"status"],[74,14,62,12],[74,16,62,14],[75,6,63,4],[75,7,63,5],[76,6,64,4,"set"],[76,9,64,7],[76,10,64,9,"state"],[76,15,64,14],[76,19,64,19],[77,8,65,6],[77,12,65,12,"next"],[77,16,65,16],[77,19,65,19],[77,20,65,20],[77,23,65,23,"state"],[77,28,65,28],[77,29,65,29,"items"],[77,34,65,34],[77,36,65,36,"newItem"],[77,43,65,43],[77,44,65,44],[78,8,66,6],[78,13,66,11,"persist"],[78,20,66,18],[78,21,66,19,"next"],[78,25,66,23],[78,26,66,24],[79,8,67,6],[79,15,67,13],[80,10,67,15,"items"],[80,15,67,20],[80,17,67,22,"next"],[81,8,67,27],[81,9,67,28],[82,6,68,4],[82,7,68,5],[82,8,68,6],[83,4,69,2],[83,5,69,3],[84,4,71,2],[84,8,71,8,"markSynced"],[84,18,71,18],[84,21,71,22,"localId"],[84,28,71,37],[84,32,71,42],[85,6,72,4,"set"],[85,9,72,7],[85,10,72,9,"state"],[85,15,72,14],[85,19,72,19],[86,8,73,6],[86,12,73,12,"next"],[86,16,73,16],[86,19,73,19,"state"],[86,24,73,24],[86,25,73,25,"items"],[86,30,73,30],[86,31,73,31,"filter"],[86,37,73,37],[86,38,73,39,"i"],[86,39,73,40],[86,43,73,45,"i"],[86,44,73,46],[86,45,73,47,"localId"],[86,52,73,54],[86,57,73,59,"localId"],[86,64,73,66],[86,65,73,67],[87,8,74,6],[87,13,74,11,"persist"],[87,20,74,18],[87,21,74,19,"next"],[87,25,74,23],[87,26,74,24],[88,8,75,6],[88,15,75,13],[89,10,75,15,"items"],[89,15,75,20],[89,17,75,22,"next"],[90,8,75,27],[90,9,75,28],[91,6,76,4],[91,7,76,5],[91,8,76,6],[92,4,77,2],[92,5,77,3],[93,4,79,2],[93,8,79,8,"markFailed"],[93,18,79,18],[93,21,79,21,"markFailed"],[93,22,79,22,"localId"],[93,29,79,37],[93,31,79,39,"error"],[93,36,79,53],[93,41,79,58],[94,6,80,4,"set"],[94,9,80,7],[94,10,80,9,"state"],[94,15,80,14],[94,19,80,19],[95,8,81,6],[95,12,81,12,"next"],[95,16,81,16],[95,19,81,19,"state"],[95,24,81,24],[95,25,81,25,"items"],[95,30,81,30],[95,31,81,31,"map"],[95,34,81,34],[95,35,81,36,"i"],[95,36,81,37],[95,40,82,8,"i"],[95,41,82,9],[95,42,82,10,"localId"],[95,49,82,17],[95,54,82,22,"localId"],[95,61,82,29],[95,64,82,32],[96,10,82,34],[96,13,82,37,"i"],[96,14,82,38],[97,10,82,40,"status"],[97,16,82,46],[97,18,82,48],[97,26,82,56],[98,10,82,58,"error"],[99,8,82,64],[99,9,82,65],[99,12,82,68,"i"],[99,13,83,6],[99,14,83,7],[100,8,84,6],[100,13,84,11,"persist"],[100,20,84,18],[100,21,84,19,"next"],[100,25,84,23],[100,26,84,24],[101,8,85,6],[101,15,85,13],[102,10,85,15,"items"],[102,15,85,20],[102,17,85,22,"next"],[103,8,85,27],[103,9,85,28],[104,6,86,4],[104,7,86,5],[104,8,86,6],[105,4,87,2],[105,5,87,3],[106,4,89,2],[106,8,89,8,"syncAll"],[106,15,89,15],[107,6,89,15],[107,10,89,15,"_ref3"],[107,15,89,15],[107,22,89,15,"_asyncToGenerator"],[107,39,89,15],[107,40,89,15,"default"],[107,47,89,15],[107,49,89,18],[107,62,89,30],[108,8,90,4],[108,12,90,4,"_get"],[108,16,90,4],[108,19,90,22,"get"],[108,22,90,25],[108,23,90,26],[108,24,90,27],[109,10,90,12,"items"],[109,15,90,17],[109,18,90,17,"_get"],[109,22,90,17],[109,23,90,12,"items"],[109,28,90,17],[110,8,91,4],[110,13,91,9],[110,17,91,15,"item"],[110,21,91,19],[110,25,91,23,"items"],[110,30,91,28],[110,32,91,30],[111,10,92,6],[111,14,92,10,"item"],[111,18,92,14],[111,19,92,15,"status"],[111,25,92,21],[111,30,92,26],[111,39,92,35],[111,41,92,37],[112,10,93,6],[112,14,93,10],[113,12,94,8],[113,18,94,14],[113,22,94,14,"createSeizure"],[113,35,94,27],[113,36,94,27,"createSeizure"],[113,49,94,27],[113,51,94,28,"item"],[113,55,94,32],[113,56,94,33,"payload"],[113,63,94,40],[113,64,94,41],[114,12,95,8,"get"],[114,15,95,11],[114,16,95,12],[114,17,95,13],[114,18,95,14,"markSynced"],[114,28,95,24],[114,29,95,25,"item"],[114,33,95,29],[114,34,95,30,"localId"],[114,41,95,37],[114,42,95,38],[115,10,96,6],[115,11,96,7],[115,12,96,8],[115,19,96,15,"e"],[115,20,96,16],[115,22,96,18],[116,12,97,8,"get"],[116,15,97,11],[116,16,97,12],[116,17,97,13],[116,18,97,14,"markFailed"],[116,28,97,24],[116,29,97,25,"item"],[116,33,97,29],[116,34,97,30,"localId"],[116,41,97,37],[116,43,97,39],[116,70,97,66],[116,71,97,67],[117,10,98,6],[118,8,99,4],[119,6,100,2],[119,7,100,3],[120,6,100,3],[120,22,89,8,"syncAll"],[120,29,89,15,"syncAll"],[120,30,89,15],[121,8,89,15],[121,15,89,15,"_ref3"],[121,20,89,15],[121,21,89,15,"apply"],[121,26,89,15],[121,33,89,15,"arguments"],[121,42,89,15],[122,6,89,15],[123,4,89,15],[123,7,100,3],[125,4,102,2],[126,4,103,2],[126,9,103,7,"loadFromStorage"],[126,24,103,22],[126,25,103,23],[126,26,103,24],[127,4,105,2],[127,11,105,9],[128,6,106,4,"items"],[128,11,106,9],[128,13,106,11],[128,15,106,13],[129,6,107,4,"isOnline"],[129,14,107,12],[129,16,107,14],[129,20,107,18],[130,6,108,4,"addPending"],[130,16,108,14],[131,6,109,4,"markSynced"],[131,16,109,14],[132,6,110,4,"markFailed"],[132,16,110,14],[133,6,111,4,"loadFromStorage"],[133,21,111,19],[134,6,112,4,"syncAll"],[135,4,113,2],[135,5,113,3],[136,2,114,0],[136,3,114,1],[136,4,114,2],[137,0,114,3],[137,3]],"functionMap":{"names":["<global>","create$argument_0","NetInfo.addEventListener$argument_0","loadFromStorage","persist","addPending","set$argument_0","markSynced","state.items.filter$argument_0","markFailed","state.items.map$argument_0","syncAll"],"mappings":"AAA;yDC0B;2BCE;GDM;0BEE;GFU;kBGE;GHM;qBIE;QCO;KDI;GJC;qBME;QDC;sCEC,4BF;KCG;GNC;qBQE;QHC;mCIC;qEJC;KGI;GRC;kBUE;GVW;CDc"},"hasCjsExports":false},"type":"js/module"}]}